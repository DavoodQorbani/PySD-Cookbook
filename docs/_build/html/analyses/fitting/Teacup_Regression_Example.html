

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hello World: The Teacup Model &mdash; PySD-Cookbook 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PySD-Cookbook 0.1.0 documentation" href="../../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> PySD-Cookbook
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index_getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/Installation_and_Setup.html">Installation and Setup of PySD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#installing-python">Installing Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#installing-pip">Installing pip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#installing-pysd">Installing PySD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#manually-installing-pysd-s-dependencies">Manually installing PySD&#8217;s dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#launch-ipython-notebook-and-get-started">Launch iPython Notebook, and get started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Installation_and_Setup.html#upgrading-pysd">Upgrading PySD</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html">Hello World: The Teacup Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#load-the-model">Load the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#run-with-default-parameters">Run with default parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#return-additional-model-components">Return additional model components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#return-values-at-a-specific-time">Return values at a specific time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#modify-parameter-values">Modify parameter values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#specifying-model-initial-conditions">Specifying model initial conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/Hello_World_Teacup.html#collecting-results">Collecting Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index_visualization.html">Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualization/Visualizations_for_Print_Media.html">Visualizations for Print Media</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visualization/Visualizations_for_Print_Media.html#contents">Contents:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visualization/Visualizations_for_Print_Media.html#other-resources">Other resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../visualization/Visualizations_for_Print_Media.html#uncertainty">Uncertainty:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_fitting.html">Model Fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Fitting_with_Optimization.html">Fitting a model&#8217;s parameters with run-at-a-time optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Fitting_with_Optimization.html#about-this-technique">About this technique</a></li>
<li class="toctree-l3"><a class="reference internal" href="Fitting_with_Optimization.html#ingredients">Ingredients:</a></li>
<li class="toctree-l3"><a class="reference internal" href="Fitting_with_Optimization.html#recipe">Recipe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Fitting_with_Optimization.html#step-1-construct-an-error-function">Step 1: Construct an &#8216;error&#8217; function</a></li>
<li class="toctree-l4"><a class="reference internal" href="Fitting_with_Optimization.html#step-2-suggest-a-starting-point-and-parameter-bounds-for-the-optimizer">Step 2: Suggest a starting point and parameter bounds for the optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="Fitting_with_Optimization.html#step-3-minimize-the-error-with-an-optimization-function">Step 3: Minimize the error with an optimization function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Step_at_a_time_optimization.html">Step-at-a-time optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Step_at_a_time_optimization.html#about-this-technique">About this technique</a></li>
<li class="toctree-l3"><a class="reference internal" href="Step_at_a_time_optimization.html#ingredients">Ingredients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#model">Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#data">Data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Step_at_a_time_optimization.html#the-recipe">The Recipe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#step-1-shape-the-dataset-such-that-each-row-contains-the-start-and-end-of-a-step">Step 1: Shape the dataset such that each row contains the start and end of a &#8216;step&#8217;</a></li>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#step-2-define-a-single-step-error-function">Step 2: Define a single-step error function</a></li>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#step-3-define-an-error-function-for-the-full-dataset">Step 3: Define an error function for the full dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="Step_at_a_time_optimization.html#result">Result</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geo/index_geo.html">Geographic Analyses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html">Using SD models to understand the differences between population measures at varying levels of geographic disagregation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#about-this-technique">About this technique</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#ingredients">Ingredients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#population-data-by-age-cohort">Population data by age cohort</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#a-model-of-an-aging-population">A model of an aging population</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#geography-information">Geography Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#recipe-part-a-predict-state-level-values-from-national-model-fit">Recipe Part A: Predict state-level values from national model fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-1-initialize-the-model-using-census-data">Step 1: Initialize the model using census data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-2-fit-the-national-level-model-to-the-remaining-data">Step 2: Fit the national level model to the remaining data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-3-make-state-level-predictions">Step 3: Make state-level predictions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-4-compare-model-predictions-with-measured-data">Step 4: Compare model predictions with measured data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-5-merge-with-geo-data-to-plot">Step 5: Merge with geo data to plot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#recipe-part-b-fit-state-by-state-models">Recipe Part B: fit state-by-state models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-1-write-the-optimization-functions-to-account-for-the-state">Step 1: Write the optimization functions to account for the state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-2-apply-optimization-to-each-state">Step 2: Apply optimization to each state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../geo/Exploring_models_across_geographic_scales.html#step-3-merge-with-geographic-data">Step 3: Merge with geographic data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../surrogating_functions/index_surrogate.html">Surrogating Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../surrogating_functions/Surrogating_with_regression.html">Surrogating a function with a machine learning estimator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index_data.html">Data Used in this Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/Ebola/Ebola_Data_Loader.html">Ebola Data Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/Census/US_Census_Data_Collection.html">Collecting US decennial census data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/Census/US_Census_Data_Collection.html#collect-data-on-male-population-by-age-county">Collect data on male population by age, county</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../data/Census/US_Census_Data_Collection.html#start-with-the-2010-census">Start with the 2010 census</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../data/Census/US_Census_Data_Collection.html#get-data-from-2000">Get data from 2000</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../data/Census/US_Census_Data_Collection.html#align-the-datasets">Align the datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/Defects_Synthetic/Manufacturing_Defects_Synthetic.html">Manufacturing Defects Synthetic Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/Baby_Names/Baby_Name_Data.html">Baby Name Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../future.html">Chapters to be Written</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">PySD-Cookbook</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Hello World: The Teacup Model</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/analyses/fitting/Teacup_Regression_Example.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="hello-world-the-teacup-model">
<h1>Hello World: The Teacup Model<a class="headerlink" href="#hello-world-the-teacup-model" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates the basic capability of PySD using a model of
a cup of tea cooling to room temperature.</p>
<p>Our model simulates <a class="reference external" href="http://www.ugrad.math.ubc.ca/coursedoc/math100/notes/diffeqs/cool.html">Newton&#8217;s Law of
Cooling</a>,
which follows the functional form:</p>
<div class="math">
\[\frac{dT}{dt} = k(T - T_{ambient})\]</div>
<p>This model has all of the canonical components of a system dynamics
model: a stock, a flow, a feedback loop, a control parameter, and
exhibits dynamic behavior. The model equations are:</p>
<div class="highlight-python"><div class="highlight"><pre>Characteristic Time=
        10
Units: Minutes

Heat Loss to Room=
    (Teacup Temperature - Room Temperature) / Characteristic Time
Units: Degrees/Minute
This is the rate at which heat flows from the cup into the room.

Room Temperature=
    70
Units: Degrees

Teacup Temperature= INTEG (
    -Heat Loss to Room,
        180)
Units: Degrees
</pre></div>
</div>
<div class="section" id="load-the-model">
<h2>Load the model<a class="headerlink" href="#load-the-model" title="Permalink to this headline">¶</a></h2>
<p>We begin by importing the PySD module using the python standard import
commands. We then use PySD&#8217;s Vensim model translator to import the model
from the Vensim model file and create a model object. We see that PySD
translates the vensim component names into acceptable python
identifiers.</p>
<div class="code python highlight-python"><div class="highlight"><pre>%pylab inline
import pysd
model = pysd.read_vensim(&#39;Teacup.mdl&#39;)
print model.components.doc()
</pre></div>
</div>
<pre class="literal-block">
Populating the interactive namespace from numpy and matplotlib
Import of Teacup.mdl

characteristic_time = 10
Type: Flow or Auxiliary
Units: Minutes

final_time = 30
Type: Flow or Auxiliary
Units: Minute
The final time for the simulation.

heat_loss_to_room = (self.teacup_temperature()- self.room_temperature()) / self.characteristic_time()
Type: Flow or Auxiliary
Units: Degrees/Minute
This is the rate at which heat flows from the cup into the room. We can                 ignore it at this point.

initial_time = 0
Type: Flow or Auxiliary
Units: Minute
The initial time for the simulation.

room_temperature = 70
Type: Flow or Auxiliary
Units:

teacup_temperature = -self.heat_loss_to_room()
Initial Value: 180
Type: Stock
Do not overwrite this functionUnits: Degrees

time_step = 0.125
Type: Flow or Auxiliary
Units: Minute [0,?]
The time step for the simulation.
</pre>
</div>
<div class="section" id="run-with-default-parameters">
<h2>Run with default parameters<a class="headerlink" href="#run-with-default-parameters" title="Permalink to this headline">¶</a></h2>
<p>To understand the general behavior of the model, we can run a simulation
using the default parameters specified by the Vensim model file. The
default behavior of the run function is to return the value of the
stocks as a <a class="reference external" href="http://pandas.pydata.org/">pandas</a> dataframe:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">stocks</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>teacup_temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000</th>
      <td>180.000000</td>
    </tr>
    <tr>
      <th>0.125</th>
      <td>178.633556</td>
    </tr>
    <tr>
      <th>0.250</th>
      <td>177.284091</td>
    </tr>
    <tr>
      <th>0.375</th>
      <td>175.951387</td>
    </tr>
    <tr>
      <th>0.500</th>
      <td>174.635237</td>
    </tr>
  </tbody>
</table>
</div><p>Pandas has some simple plotting utility built in which allows us to
easily visualize the results.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">stocks</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.figure.Figure at 0x11596e790&gt;
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_5_1.png" src="../../_images/Teacup_Regression_Example_5_1.png" />
</div>
<div class="section" id="return-additional-model-components">
<h2>Return additional model components<a class="headerlink" href="#return-additional-model-components" title="Permalink to this headline">¶</a></h2>
<p>If we wish to see the values of model components other than the stocks,
we can pass a list of component names with the keyword argument
<code class="docutils literal"><span class="pre">return_columns</span></code>. This will change the columns of the returned
dataframe such that they contain samples of the requested model
components:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;teacup_temperature&#39;</span><span class="p">,</span> <span class="s">&#39;room_temperature&#39;</span><span class="p">])</span>
<span class="n">values</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">)</span>
<span class="n">values</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>teacup_temperature</th>
      <th>room_temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000</th>
      <td>180.000000</td>
      <td>70</td>
    </tr>
    <tr>
      <th>0.125</th>
      <td>178.633556</td>
      <td>70</td>
    </tr>
    <tr>
      <th>0.250</th>
      <td>177.284091</td>
      <td>70</td>
    </tr>
    <tr>
      <th>0.375</th>
      <td>175.951387</td>
      <td>70</td>
    </tr>
    <tr>
      <th>0.500</th>
      <td>174.635237</td>
      <td>70</td>
    </tr>
  </tbody>
</table>
</div><img alt="../../_images/Teacup_Regression_Example_7_1.png" src="../../_images/Teacup_Regression_Example_7_1.png" />
</div>
<div class="section" id="return-values-at-a-specific-time">
<h2>Return values at a specific time<a class="headerlink" href="#return-values-at-a-specific-time" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we want to specify the timestamps that the run function should
return values. For instance, if we are comparing the result of our model
with data that arrives at irregular time intervals. We can do so using
the <code class="docutils literal"><span class="pre">return_timestamps</span></code> keyword argument. This argument expects a list
of timestamps, and will return values at those timestamps.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">stocks</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_timestamps</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">9.5</span><span class="p">,</span> <span class="mf">13.178</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="n">stocks</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">)</span>
<span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>teacup_temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>180.000000</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>169.532117</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>151.490005</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>124.624384</td>
    </tr>
    <tr>
      <th>9.5</th>
      <td>112.541513</td>
    </tr>
  </tbody>
</table>
</div><img alt="../../_images/Teacup_Regression_Example_9_1.png" src="../../_images/Teacup_Regression_Example_9_1.png" />
</div>
<div class="section" id="modify-parameter-values">
<h2>Modify parameter values<a class="headerlink" href="#modify-parameter-values" title="Permalink to this headline">¶</a></h2>
<p>We can specify changes to the parameters of the model in the call to the
run function. Here we set the room temperature to the constant value of
20 degrees before running the simulation.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;room_temperature&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">})</span>
<span class="n">values</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_11_0.png" src="../../_images/Teacup_Regression_Example_11_0.png" />
<p>We can also specify that a parameter be set with a time-varying input.
In this case, we raise the room temperature from 20 to 80 degrees over
the course of the 30 minutes. We can see that once the room temperature
rises above that of the tea, the tea begins to warm up again.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">temp_timeseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;room_temperature&#39;</span><span class="p">:</span><span class="n">temp_timeseries</span><span class="p">},</span><span class="n">return_columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;teacup_temperature&#39;</span><span class="p">,</span> <span class="s">&#39;room_temperature&#39;</span><span class="p">])</span>
<span class="n">values</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_13_0.png" src="../../_images/Teacup_Regression_Example_13_0.png" />
</div>
<div class="section" id="specifying-model-initial-conditions">
<h2>Specifying model initial conditions<a class="headerlink" href="#specifying-model-initial-conditions" title="Permalink to this headline">¶</a></h2>
<p>In addition to parameters, we can set the initial conditions for the
model, by passing a tuple to the argument <code class="docutils literal"><span class="pre">initial_condition</span></code>. In this
case, the first element of the tuple is the time at which the model
should begin its execution, and the second element of the tuple is a
dictionary containing the values of the stocks at that particular time.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">stocks</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;room_temperature&#39;</span><span class="p">:</span><span class="mi">75</span><span class="p">},</span>
                   <span class="n">initial_condition</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;teacup_temperature&#39;</span><span class="p">:</span><span class="mi">33</span><span class="p">}))</span>
<span class="n">stocks</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_15_0.png" src="../../_images/Teacup_Regression_Example_15_0.png" />
<p>Once a model has been run, we can choose to run it forwards again from
its current state. To do this we specify a new set of timestamps over
which we would like the model to run, and pass the
<code class="docutils literal"><span class="pre">intitial_condition</span></code> argument the string <code class="docutils literal"><span class="pre">&quot;current&quot;</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">initial_condition</span><span class="o">=</span><span class="s">&#39;current&#39;</span><span class="p">,</span> <span class="n">return_timestamps</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span><span class="mi">45</span><span class="p">))</span>
<span class="n">values</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Degrees F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_17_0.png" src="../../_images/Teacup_Regression_Example_17_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#generate a dataset from the model to fit our regression to</span>

<span class="n">X_training</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Y_training</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">room_temp</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">tea_temp</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="n">X_training</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">room_temp</span><span class="p">,</span> <span class="n">tea_temp</span><span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">set_components</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;room_temperature&#39;</span><span class="p">:</span><span class="n">room_temp</span><span class="p">})</span>
        <span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;teacup_temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tea_temp</span>
        <span class="n">Y_training</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">heat_loss_to_room</span><span class="p">())</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>

<span class="n">regression</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">()</span>
<span class="n">regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_training</span><span class="p">,</span> <span class="n">Y_training</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
  <span class="n">kernel</span><span class="o">=</span><span class="s">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
  <span class="n">shrinking</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">[</span><span class="n">regression</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="mi">66</span><span class="p">,</span> <span class="n">teatemp</span><span class="p">])</span> <span class="k">for</span> <span class="n">teatemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">180</span><span class="p">)])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x114522e50&gt;]
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_20_1.png" src="../../_images/Teacup_Regression_Example_20_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">new_heatflow_function</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Replaces the original flowrate equation with a regression model&quot;&quot;&quot;</span>
    <span class="n">tea_temp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">teacup_temperature</span><span class="p">()</span>
    <span class="n">room_temp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">room_temperature</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">regression</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">room_temp</span><span class="p">,</span> <span class="n">tea_temp</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">heat_loss_to_room</span> <span class="o">=</span> <span class="n">new_heatflow_function</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">heat_loss_to_room</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">10.823590010163151</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1144cf410&gt;
</pre></div>
</div>
<img alt="../../_images/Teacup_Regression_Example_23_1.png" src="../../_images/Teacup_Regression_Example_23_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">teacup_temperature</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">180</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, James Houghton.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>